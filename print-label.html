<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Print Label</title>

    <style>
        @page { margin: 0; }
        body { margin: 0; }

        #label {
            position: relative;
            background: white;
        }

        .label-text {
            position: absolute;
            white-space: pre;
        }

        .label-image,
        .label-barcode {
            position: absolute;
        }
    </style>
</head>
<body>

<div id="label"></div>

<script>
    /**
     * labelData MUST be injected before calling render()
     * structure = EXACTLY what your backend returns
     */

    function renderLabel(labelData) {
        const label = document.getElementById('label');

        const DPI = 96; // browser DPI
        const widthPx = labelData.stage.width * DPI;
        const heightPx = labelData.stage.height * DPI;

        label.style.width = widthPx + 'px';
        label.style.height = heightPx + 'px';

        label.innerHTML = '';

        labelData.elements.forEach(el => {

            // ðŸ”¤ TEXT
            if (el.type === 'text') {
                const div = document.createElement('div');
                div.className = 'label-text';
                div.textContent = el.text;

                div.style.left = el.x + 'px';
                div.style.top = el.y + 'px';
                div.style.fontSize = el.font.size + 'px';
                div.style.fontFamily = el.font.family;
                div.style.color = el.font.color;
                div.style.transform = `rotate(${el.rotation || 0}deg)`;

                label.appendChild(div);
            }

            // ðŸ–¼ IMAGE
            if (el.type === 'image') {
                const img = document.createElement('img');
                img.className = 'label-image';
                img.src = el.url;

                img.style.left = el.x + 'px';
                img.style.top = el.y + 'px';
                img.style.width = el.width + 'px';
                img.style.height = el.height + 'px';
                img.style.transform = `rotate(${el.rotation || 0}deg)`;

                label.appendChild(img);
            }

            // ðŸ”³ BARCODE / QR (already base64 image)
            if (el.type === 'barcode') {
                const img = document.createElement('img');
                img.className = 'label-barcode';
                img.src = el.url;

                img.style.left = el.x + 'px';
                img.style.top = el.y + 'px';
                img.style.width = el.width + 'px';
                img.style.height = el.height + 'px';
                img.style.transform = `rotate(${el.rotation || 0}deg)`;

                label.appendChild(img);
            }
        });

        setTimeout(() => window.print(), 300);
    }

    // ðŸ‘‡ this will be called by parent window
    window.renderAndPrint = function (labelJson) {
        renderLabel(labelJson);
    };
</script>

</body>
</html>
